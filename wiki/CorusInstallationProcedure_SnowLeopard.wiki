#summary Corus Installation Procedure for Mac OSX 10.6 (Snow Leopard)

= Introduction =

This page will guide you through the necessary steps to install Corus on Mac OS X 10.6 (64 bits).


= 1. Preparing the environment =

== i) Java ==
 * Before installing Corus you need to have Java installed on your machine. Corus requires at least Java 6.
 * Since Apple manages the Java version on Mac OS, make sure your system is up to date with the latest release.

== ii) Installation directory ==
 * You need to create a directory on your system in which you will install Corus.
 * For the purpose of this demonstration, we create the `/opt/sapia-corus` directory (as root user).
 ||` Cygnus:~ root# mkdir /opt/sapia-corus`<br />` Cygnus:~ root# `||


= 2. Extract the Corus distribution =
 * Extract the Corus distribution file into the Corus installation directory created above.
 ||` Cygnus:sapia-corus root# tar -xvf ../datastore/sapia_corus_server-2.0-osx64.tar.gz `<br />` Cygnus:sapia-corus root# `||

 * Rename the created root directory of the archive if you need.
 * For example, we extracted the tar and the files reside under the directory `/opt/sapia-corus/sapia_corus-2.0`


= 3. Configure the Environment =
 * To run properly, Corus requires the presence of another environment variable: CORUS_HOME
 * The variable must point to the home directory of the Corus installation, which in our case is the `/opt/sapia-corus/sapia_corus-2.0` directory
 * However, we suggest the usage of a `current` symbolic link under `/opt/sapia-corus` to facilitate the future upgrades of Corus. That way if you ever extract another distribution of Corus you will simply have to change the symbolic link and upon restart the new distribution will start.
 * Here an example of how to create a symbolic link using the `ln` command (make sure you are in the install direcotry):

 || `Cygnus:sapia-corus root# pwd`<br />`/opt/sapia-corus`<br /><br />`Cygnus:sapia-corus root# ln -s sapia_corus-2.0/ current`<br /><br />`Cygnus:sapia-corus root# ls -l current`<br />`lrwxr-xr-x  1 JC  admin  16 Dec 20 09:50 current -> sapia_corus-2.0/`<br /><br />`Cygnus:sapia-corus root# ` ||

 * To define an environment variable on OS X, we suggest to modify the file `/etc/profile` which contains the global environment variables setup for every user.
 * Using `vi` (or the file editor of your choice) add the following lines to the file:
 ||` export CORUS_HOME=/opt/sapia-corus/current `||

 * You can also modify the `$PATH` environment variable to have an easy access to the various commands of the Corus distribution
 * To do so, edit the `/etc/profile` file again and add the following lines to it:
 || ` export PATH=${PATH}:${CORUS_HOME}/bin` ||

At this point you should be able to start Corus by manually invoking the `$CORUS_HOME\bin\corus` file. However performing this task manually is cumbersome. The next section will guide you through the steps to register Corus as a service with the` launchd` system tool.


= 4. Launchd Integration = 
With the installation of Corus as a system service (with `launchd`), you will be able to automatically start Corus on startup of your machine. OS X provides the `launchctl` command that help configuring the launch daemon process. Once properly registered you can easily stop and start the Corus service using the `launchctl` command.

To register Corus as a system service, you need to:
== i) Define a Corus configuration file ==
 * you need to define a Corus configuration file that will be used when the service starts.
 * We provide a default configuration file to help you: it is located under `$CORUS_HOME/config/corus_service_33000.wrapper.properties`. You can have a look at the configuration section to know how to customize Corus.

== ii) Prepare the plist file ==
 * An XML file is available to register Corus as a launch daemon : it located under `$CORUS_HOME/config/org.sapia.corus-33000.plist`
 * Copy it under the directory `/etc//Library/LaunchDaemons/`(make sure you are using root user)
 ||` Cygnus:config root# sudo cp org.sapia.corus-33000.plist /Library/LaunchDaemons/ `<br />`Cygnus:config root#`||

 * Once copied, you need to edit the file and set the proper value for the $CORUS_HOME variable and set the proper corus configuration file.
 * By default, the file is configured to use the `$CORUS_HOME/config/corus_service_33000.wrapper.properties` file (so you can have a try right now).

== iii) Register with launchd ==
 * Once you are ready, you simply have to "load" the plist file using the `launchctl` command (as root):

 || ` Cygnus:config root# sudo launchctl load /Library/LaunchDaemons/org.sapia.corus-33000.plist `<br />` Cygnus:config root# ` ||

 * You can validate the registration like that:

 || ` Cygnus:config root# sudo launchctl list org.sapia.corus-33000 `<br />` { `<br />` 	"Label" = "org.sapia.corus-33000"; `<br />` 	"LimitLoadToSessionType" = "System"; `<br />` 	"OnDemand" = true; `<br />` 	"LastExitStatus" = 0; `<br />` 	"PID" = 54; `<br />` 	"TimeOut" = 30; `<br />` 	"StandardOutPath" = "/opt/sapia-corus/current/bin/logs/corus-launchd.log"; `<br />` 	 "StandardErrorPath" = "/opt/sapia-corus/current/bin/logs/corus-launchd.log"; `<br />` 	"ProgramArguments" = ( `<br />` 		"/opt/sapia-corus/current/bin/corus_service.sh"; `<br />` 		"start"; `<br />` 
		"33000"; `<br />` 	); `<br />` }; `<br /><br />` Cygnus:config root# ` ||


 * As you can see upon registration, `launchd` automatically starts the Corus service.
 * `lauchd` will also take care of restarting Corus onthe next reboot of your machine.


You can validate the proper execution of the Corus service by: 

1. looking at the Corus log files that resides under the `$CORUS_HOME/logs` directory

2. starting the Corus CLI (Command Line Interface) to connect to the server. The script is called `coruscli` and resides under the `$CORUS_HOME/bin` directory. If you previously added the `$CORUS_HOME/bin` directory in the `$PATH` environment variable, you can simply invoke the script. Otherwise you will have to get to the bin directory and invoke the command.

<table boder="0" width="50%">
<tr><td>
<a href="http://sapia.googlecode.com/svn/wiki/resources/ScreenShot_OSXSnowLeopard_CorusCLI.jpg"><img width="100%" src="http://sapia.googlecode.com/svn/wiki/resources/ScreenShot_OSXSnowLeopard_CorusCLI.jpg" /></a>
</td></tr>
<tr align="center"><td>_Click on the image for full size resolution_</td></tr>
</table>

And that is pretty much it for the installation. You can now envoy Corus. 

== iv) Manage the Corus System Service ==
 * Using the `launchctl` command you can stop and start the Corus service

|| `Cygnus:~ root# sudo launchctl stop org.sapia.corus-33000` <br /> `Cygnus:~ root#  ` <br /><br /> `Cygnus:~ root# sudo launchctl start org.sapia.corus-33000` <br /> `Cygnus:~ root#  ` ||

 * If you ever need to remove the Corus system service, you can use the `launchctl remove` command
 
|| ` Cygnus:~ root# sudo launchctl remove org.sapia.corus-33000` <br /> `Cygnus:~ root#` ||

 